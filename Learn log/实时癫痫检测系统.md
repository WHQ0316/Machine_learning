# 基于脑电采集设备的二次开发：实时癫痫检测系统

## （软硬件协同）

---

### 硬件（数据中转设备）：

- 蓝牙（BLE）
- WIFI
- GPS

具体细节：

- 脑电设备将采集到的EEG信号通过蓝牙发送给" 数据中转设备 "，中转设备将采集到的BLE数据放入数据池（循环队列）中。

- 同时串口UART每1秒读取一次位置信息，解析NMEA0183数据，只拿经纬度信息。

- 每次从数据池中拿取最新的两秒数据，位置信息和当前时间戳打包成 JSON数据包 通过WIFI发送POST请求，发送给服务器用于接收数据API接口。

    

|               模块                |       型号       |
| :-------------------------------: | :--------------: |
|              单片机               | ESP32-S3（N6R8） |
| 定位模块（UART : GPIO17、GPIO18） |  大夏龙雀 GP10   |



---

### 软件（服务器+Web）：

#### 服务器

- API 接口
    - 数据接收API
    - 用户访问API
        - 登录
        - 用户
        - 注册
    - 高德定位API

- 数据处理
    - 定位解析 + 位置逆编码（高德API）
    - 蓝牙解包（恢复数据形状）
    - 癫痫模型检测
    - 动态分配队列（避免拥堵）
- Web Socket 实时推送（全双工通信，允许服务器主动推送数据）
    - 为每个设备建立一个单独的房间
    - 用户登陆后，检测用户的设备，加入设备房间，监听房间的数据
    - 设备队列中如果有数据，将数据发送到设备的房间，进行更新



---

### 模型（轻量化）：

- 数据预处理：

    - ```txt
        1. 读取原始数据（EDF文件）
        2. 重采样到200Hz
        3. 通道选择
        4. 将数据从 V 转换为 μV，并更新单位信息
        5. 带通滤波：0.5 - 40 Hz
        6. 获取数据并进行 Z-score 标准化（逐通道）
        数据形状：样本_shape = (n_channels, n_times) = (6, 400)
        ```

- 通道选择：

    - ```txt
        -------------------------------------------------
             导联      覆盖区域       癫痫类型
        -------------------------------------------------
             F7-T7   左前颞叶       局灶性（颞叶）
             T7-P7   左中后颞叶  颞叶扩散性放电
             F8-T8   右前颞叶       局灶性（颞叶）
             T8-P8   右中后颞叶  颞叶扩散性放电
             FZ-CZ   额-中央中线 全面性/额叶中线发作
             CZ-PZ   中央-顶中线 全面性发作
        -------------------------------------------------
           【覆盖 >90% 的常见癫痫发作类型（颞叶+全面性）】
        -------------------------------------------------     
        ```

- 模型设计：

    - 1D-CNN
    - 多尺度
    - 注意力融合

``````
multiscale convolutional neural networks for EEG
attention mechanism in EEG analysis
# 随机种子
``````



---

### 优点：

​	1、便携性：中转设备和脑电采集设备分离，减缓了脑电采集设备的重量和体积的同时增强了舒适性；

​	2、实时性：蓝牙接收数据（2s），UART串口读取数据(1s)，WIFI上传数据（2s），并行处理，减少时间的消耗；同时将模型检测和蓝牙解包以及定位解析的工作量放在服务器进行，减少了硬件计算时间的成本；

​	3、适用性：从传统的物理有线连线更改为低功耗蓝牙连接，提高了对不同型号脑电采集设备的适用性，从而只需要随着脑电采集设备的优化，就可以对整个系统进行优化。

